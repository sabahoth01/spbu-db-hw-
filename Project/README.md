# Система управления миссиями и персоналом частной охранной организации

## 1. Описание предметной области

### Описание

Частная охранная организация имеет штаб **СОТРУДНИКОВ**, которые могут занимать различные **должности**. 
Каждый сотрудник имеет **МЕДКАРТУ** и закрепленную за ним **БАЗУ**, являющуюся его основным местом пребывания. 
Сотрудники могут быть направлены на **ЗАДАЧИ**. 
Задача является важной частью охранной **КАМПАНИИ** на **ТРАНСПОРТЕ**, принадлежащем охранной организации.

Для безопасности стоит хранить историю всех **ТЕХОСМОТРОВ**. 
Сотрудникам должны предоставляться комплекты **ЭКИПИРОВКИ**.
Экипировка в обязательном порядке должна включать один из ИРП и может содержать одно или несколько **ОРУЖИЙ**.

### Правила

**_СОТРУДНИКИ_** : работникИ, необходимо узнать ИМЯ, ФАМИЛИЮ, ДАТУ_РОЖДЕНИЯ, ОБРАЗОВАНИЕ и текущий СЕМЕЙНЫЙ_СТАТУС, а также хранить его ДАТУ_ЗАЧИСЛЕНИЯ на службу.

**_ДОЛЖНОСТИ_** : НАЗВАНИЕ_ДОЛЖНОСТИ, ЗАРПЛАТУ ВОИНСКОЕ_ЗВАНИЕ если есть, номер комплекта ЭКИПИРОВКИ, и тип ВООРУЖЕННЫХ_СИЛ (также работники могут занимать гражданские должности).

**_МЕДКАРТА_** : с информацией о РОСТЕ в см, ВЕСЕ в кг, ГРУППЕ_КРОВИ (по системе AB0), ПЕРЕНЕСЁННЫХ_ТРАВМАХ/ЗАБОЛЕВАНИЯХ, БИОЛОГИЧЕСКОМ_ПОЛЕ

**_БАЗА_** : с информацией о МЕСТОПОЛОЖЕНИИ базы и её СТАТУСЕ

**_МИССИИ_** : нужно хранить НАЗВАНИЕ, ДАТУ_И_ВРЕМЯ_СТАРТА и ЗАВЕРШЕНИЯ, ЮРИДИЧЕСКИЙ_СТАТУС, МЕСТО_ОТПРАВЛЕНИЯ и ПРИБЫТИЯ, ВРАГОВ, а также историю миссий сотрудников

**_ОРГАНИЗАЦИЯ_** : должно содержать НАЗВАНИЕ, ЗАКАЗЧИКА, ПРИБЫЛЬ, ЗАТРАТЫ и СТАТУС_ВЫПОЛЕНИЯ

_**ТРАНСПОРТ**_ : НАЗВАНИЕ, ТИП, СОСТОЯНИЕ 

**_ЭКИПИРОВКИ_** : может быть (но необязательно) КАМУФЛЯЖ, СРЕДСТВА_КОММУНИКАЦИИ, РАЗВЕДКИ, МЕДИКАМЕНТЫ и ПРОЧЕЕ.
В обязательном порядке должна включать один из ИРП (с описанием о БЕЛКАХ, ЖИРАХ, УГЛЕВОДАХ и КАЛОРИЙНОСТИ, блюдах ЗАВТРАКА, ОБЕДА, УЖИНА, ПИЩЕВЫХ_ДОБАВКАХ).

**_ОРУЖИЯ_** : с техническими характеристиками, будь то НАЗВАНИЕ, ТИП, КАЛИБР, СКОРОСТРЕЛЬНОСТЬ, ДЛИНА_СТВОЛА, ПРИЦЕЛЬНАЯ_ДАЛЬНОСТЬ

### Бизнес-процессы

Лица, не имеющие необходимых квалификаций, не могут быть отправлены на охранные задачи. 
Информационная система должна учитывать, какие сотрудники находятся на задачах (один и тот же сотрудник не может находиться на двух задачах одновременно).
Запрещается нанимать работников с неподходящими физическими данными в качестве охранников. 
Необходимо хранить историю инспекций транспорта, а транспорт со статусами «сломано» или «в ремонте» нельзя использовать в операциях. 
Если за базой не закреплён ни один сотрудник, стоит закрыть её. При прочих равных условиях старайтесь отправлять на охранные операции в первую очередь неженатых сотрудников, 
которые давно не участвовали в задачах и имеют большой опыт работы.

## 2. Модели

- Инфо логическая модель
- Дата логическая модель

## 3. Улучшение структуры БД

### Нормальная форма (Database normalization)
Под. Описание [wikipedia](https://ru.wikipedia.org/wiki/%D0%9D%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0)

Нормализация позволяет оптимально распределять атрибуты по таблицам. Данная методика избавляет от:
- атрибутов с несколькими значениями;
- повторяющихся атрибутов;
- атрибутов, не поддающихся классификации;
- атрибутов с избыточной информацией;
- атрибутов, созданных из других признаков.

1. Первая нормальная форма (1NF)
Таблица находится в 1NF, если она имеет Атомарные значения (нет повторяющихся групп или массивов) и 
Каждая строка уникально идентифицируется первичным ключом.
Мои схемы уже соответствуют 1NF, так как каждый столбец содержит атомарные значения, и первичные ключи определены для всех таблиц.

2. Вторая нормальная форма (2NF)
Таблица находится во 2NF, если:
Она находится в 1NF.
Все неключевые атрибуты полностью функционально зависят от первичного ключа (нет частичной зависимости).
Мои схемы уже соответствуют 2NF.

3. Третья нормальная форма (3NF)
Таблица находится в 3NF, если:
Она находится в 2NF.
Нет транзитивной зависимости, что означает, что неключевые атрибуты не должны зависеть от других неключевых атрибутов.

Таблица сотрудников: таблица включает ссылку на внешний ключ base_id, что можно считать транзитивной зависимостью.<br/>
Вместо того чтобы напрямую хранить base_id, могу создать новую таблицу, которая связывает сотрудников с их базой, и удалить прямую ссылку из таблицы сотрудников.
Чтобы решить эту проблему, создаю отдельную таблицу employee_base:

```CREATE TABLE employee_base (
    emp_id INTEGER NOT NULL REFERENCES employee ON DELETE CASCADE,
    base_id INTEGER NOT NULL REFERENCES base ON DELETE SET NULL,
    PRIMARY KEY (emp_id, base_id)
);
```

Это устраняет транзитивную зависимость от base_id в таблице сотрудников и улучшает 3NF.

4. Нормальная форма Бойса-Кодда (BCNF)
Таблица находится в BCNF, если:
Она находится в 3NF.
Для каждой нетривиальной функциональной зависимости детерминант является кандидатом в ключи.
Таблица employee_base, описанная выше, поможет обеспечить отсутствие нетривиальных функциональных зависимостей, нарушающих BCNF.

После этого, давайте подумаем о том, какие запросы будут наиболее часто используемыми (востребованными) для этой базы данных. В моем случае, я думаю, что нам обычно потребуется:
- Извлекать данные о сотрудниках, обновлять их и получать информацию о здоровье сотрудников,
- знать о различных миссиях, доходах и клиентах,
- а также о состоянии нашего транспорта.
Основываясь на этом, давайте используем некоторые полезные методы для повышения производительности этой базы данных:

### Временные структуры и представления, способы валидации запросов 
- Представления (Views)
- Материализованные представления (Materialized Views)
- Индексы (Indexes)
- Общие табличные выражения (CTE)
- Временные таблицы (Temporary Tables)

## 4. Триггеры и транзакции

Давайте создадим функции, а затем триггеры. Функции создаются в соответствии с бизнес-процессом, 
который я предоставила(см. Пункт бизнес-процесс).

Я также решила добавить хранимые процедуры. Хранимые процедуры выполняют более крупные действия и могут изменять данные (обычно используются для выполнения общих операций с базой данных, 
обработки данных и автоматизации сложных задач.<br/>
Они особенно ценны для повышения безопасности базы данных, модульности, автоматизации сложных задач и повторного использования кода), 
в то время как функции сосредоточены на вычислениях и извлечении данных, обеспечивая гибкость.

